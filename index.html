<html>

<body>
    <h1>Conway's game of life</h1>
    <p>Talk to make life</p>
    <div id="g"></div>
    <style>
        #g {
            display: fixed;
            inset: 0;
            display: grid;
            grid-template-columns: repeat(32, 1fr);
            grid-template-rows: repeat(32, 1fr);
            color: #026;
            background: #026;
            aspect-ratio: 1;
            overflow: hidden;
        }

        @keyframes b {
            from {
                color: #026;
            }

            to {
                color: #3b7;
            }
        }

        @keyframes l {
            from {
                color: #3b7;
            }

            to {
                color: #026;
            }
        }

        @keyframes c {
            0% {
                color: #3b7;
            }

            80% {
                color: #d80;
            }

            100% {
                color: #026;
            }
        }


        #g>* {
            position: relative;
            width: min(4dvw, 4dvh);
            aspect-ratio: 1;
            border: 0;
            color: transparent;
            background: transparent;

            * {
                border-radius: 100%;
                display: block;
                position: absolute;
                top: -25%;
                left: -25%;
                bottom: -25%;
                right: -25%;
                background: transparent radial-gradient(circle at center, currentColor, #0260 65%);
            }

            &.a {
                color: #3b7;
            }

            &.b {
                animation: b 300ms;
            }

            &.l {
                animation: l 300ms;
            }

            &.c {
                animation: c 300ms;
            }
        }
    </style>
    <script>wi=32;d=document;ce=t=>d.createElement(t);ac=(e,c)=>e.appendChild(c);t=setTimeout;cl=e=>e.classList;cr=(e,r)=>cl(e).remove(r);st=(e,a,r)=>cl(e).add(a)&&(r&&t(v=>cr(e,r),50));el=Array.from({length:wi}).map((v,y)=>Array.from({length:wi}).map((v,x)=>{let e=ce('button');e.onclick=v=>cl(e).toggle('a');ac(e,ce('i'));ac(d.getElementById('g'),e);return e}));ia=e=>e&&cl(e).contains('a');ne=(y,x)=>{let n = 0;for(k=y-1;k<y+2;k++)for(j=x-1;j<x+2;j++)(k!=y||j!=x)&&(ia(el[k]?.[j]))&&n++;return n};navigator.mediaDevices.getUserMedia({audio:true}).then(sm=>{let au=new AudioContext;let sr=au.createMediaStreamSource(sm);let an=au.createAnalyser();an.fftSize=wi*2;let da=new Uint8Array(an.frequencyBinCount);sr.connect(an);let dr=v=>{requestAnimationFrame(dr);an.getByteTimeDomainData(da);for (x in da)st(el[Math.floor([x]/128.0*w)][x], 'a')};dr()});sp=v=>{for(let y in el){for(let x in el[y]){let e = el[y][x];['b','l','c'].map(l=>cr(e,l));let m=ne(parseInt(y),parseInt(x));let a=ia(e);(a&&m<2&&(st(e,'l','a')||1))||(a&&m>3&&(st(e,'c','a')||1))||(!a&&m==3&&(st(e,'b')||t(v=>st(e,'a','b'),250)))}}t(sp,600)};sp();</script>
</body>

</html>